<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Beta V.4 (stable)</title>
<style>
  :root{ --bg:#ffffff; --ink:#111; --bar:#000; --accent:#d71920; --stageW: 260px; --stageH: 340px; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
  .topbar{background:#000;color:#fff;}
  .nav{max-width:1200px;margin:0 auto;display:flex;gap:36px;align-items:center;justify-content:center;padding:14px 16px;font-weight:700}
  .nav a{color:#fff;text-decoration:none;opacity:.9}
  .nav a:hover,.nav a.active{opacity:1;text-decoration:underline}
  .wrap{text-align:center;margin:28px auto}
  h1{margin:12px 0 18px;font-size:32px}
  .duo-btn{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:12px 20px;font-weight:700;cursor:pointer}
  .stage{width:var(--stageW);height:var(--stageH);margin:30px auto;perspective:1000px;}
  .card{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform 1.2s ease-in-out;}
  .card.flip{transform:rotateY(180deg);}
  .cardFace{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:16px;overflow:hidden}
  .cardFace img{width:100%;height:100%;object-fit:cover;}
  .cardBack{transform:rotateY(180deg);}
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:30}
  .modal{position:fixed;inset:0;display:none;z-index:40;place-items:center}
  .cardModal{width:min(100% - 32px, 1000px);background:#fff;border-radius:16px;padding:18px}
  .card-head{display:flex;align-items:center;margin-bottom:12px}
  .card-head h2{margin:0;font-size:20px}
  .close{margin-left:auto;border:1px solid #ddd;background:#f7f7f7;padding:6px 10px;border-radius:6px;cursor:pointer}
  .grid{display:grid;grid-template-columns:200px 1fr 200px;gap:18px;align-items:center;margin-bottom:14px}
  .portrait{width:100%;max-width:180px;border-radius:12px}
  .muted{text-align:center;font-size:14px;color:#666;margin-top:6px}
  .transcript{height:280px;background:#fafafa;border:1px solid #e9e9e9;border-radius:12px;padding:12px;overflow:auto}
  .line{margin:6px 0}
  .line .bubble{display:inline-block;padding:8px 10px;border-radius:12px;border:1px solid #e0e0e0;background:#fff;max-width:85%}
  .line.left{text-align:left}
  .line.right{text-align:right}
  .left .bubble{background:#eef6ff}
  .right .bubble{background:#f7f3ff}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .controls input{flex:1;min-width:260px;padding:8px;border:1px solid #ccc;border-radius:6px}
  .controls button{padding:8px 14px;border:none;border-radius:6px;cursor:pointer;color:#fff}
  .btnV{background:#28a745}.btnO{background:#17a2b8}.btnB{background:#007bff}
</style>
</head>
<body>
  <div class="topbar">
    <nav class="nav">
      <a href="#">HOME</a><a href="#">ABOUT</a><a href="#">SERVICES</a>
      <a href="#">PORTFOLIO</a><a href="#">CONTACT</a>
      <a href="#" class="active">BETA</a><a href="#">DOWNLOAD</a>
    </nav>
  </div>
  <div class="wrap">
    <h1>BETA V.4 (stable)</h1>
    <button id="openDuo" class="duo-btn">Duo Chat</button>
  </div>
  <div class="stage">
    <div id="flipCard" class="card">
      <div class="cardFace cardFront"><img src="./assets/veya.png" alt="Veya"></div>
      <div class="cardFace cardBack"><img src="./assets/orion.png" alt="Orion"></div>
    </div>
  </div>

  <div id="duoBackdrop" class="backdrop"></div>
  <div id="duoModal" class="modal">
    <div class="cardModal">
      <div class="card-head">
        <h2>Veya &amp; Orion — Duo</h2>
        <button class="close" id="closeDuo">Close</button>
      </div>
      <div class="grid">
        <div><img src="./assets/veya.png" class="portrait"/><div class="muted">Veya</div></div>
        <div class="transcript" id="transcript"><em style="color:#666;font-size:13px;">Type a message…</em></div>
        <div><img src="./assets/orion.png" class="portrait"/><div class="muted">Orion</div></div>
      </div>
      <div class="controls">
        <input type="text" id="userInput" placeholder="Type your message…"/>
        <button id="sendVeya" class="btnV">Send to Veya</button>
        <button id="sendOrion" class="btnO">Send to Orion</button>
        <button id="sendBoth" class="btnB">Send to Both</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const transcript = $('#transcript');
  let voices = [], avaVoice=null, nathanVoice=null;

  function loadVoices(){
    voices = speechSynthesis.getVoices();
    avaVoice = voices.find(v=>v.name === "Ava (Enhanced)") || voices.find(v=>v.name === "Ava") || null;
    nathanVoice = voices.find(v=>v.name === "Nathan") || null; // force standard Nathan
  }
  speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();

  function speak(text, speaker){
    if(!window.speechSynthesis) return;
    const utter = new SpeechSynthesisUtterance(text);
    if(speaker==="Veya" && avaVoice) utter.voice = avaVoice;
    if(speaker==="Orion" && nathanVoice) utter.voice = nathanVoice;
    speechSynthesis.speak(utter);
  }

  function escapeHTML(s){return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}
  function addLine(speaker,text, speakIt=true){
    const side = speaker==='Veya' ? 'left' : speaker==='Orion' ? 'right' : 'left';
    const row = document.createElement('div');
    row.className = `line ${side}`;
    row.innerHTML = `<span class="bubble"><strong>${escapeHTML(speaker)}:</strong> ${escapeHTML(text)}</span>`;
    transcript.appendChild(row);
    transcript.scrollTop = transcript.scrollHeight;
    if(speakIt && (speaker==="Veya" || speaker==="Orion")) speak(text,speaker);
  }

  // Flip animation
  let flipped=false;
  setInterval(()=>{$('#flipCard').classList.toggle('flip', flipped=!flipped);},5000);

  // Modal open/close
  $('#openDuo').addEventListener('click',()=>{ $('#duoModal').style.display='grid'; $('#duoBackdrop').style.display='block'; });
  $('#closeDuo').addEventListener('click',()=>{ $('#duoModal').style.display='none'; $('#duoBackdrop').style.display='none'; });
  $('#duoBackdrop').addEventListener('click',()=>{ $('#duoModal').style.display='none'; $('#duoBackdrop').style.display='none'; });

  async function sendTo(speaker){
    const inputEl=$('#userInput'); const text=inputEl.value.trim(); if(!text) return;
    inputEl.value="";
    addLine("You → "+speaker,text,false);
    try{
      const res=await fetch('/ask',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({speaker,input:text})});
      const data=await res.json();
      addLine(speaker,data.response,true);
    }catch(e){addLine("System","Server error",false);}
  }

  async function sendBoth(){
    const inputEl=$('#userInput'); const text=inputEl.value.trim(); if(!text) return;
    inputEl.value="";
    addLine("You → Both",text,false);
    try{
      const res=await fetch('/askBoth',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({input:text})});
      const data=await res.json();
      if(data && data.response){
        addLine("Veya",data.response.veya,true);
        addLine("Orion",data.response.orion,true);
      }
    }catch(e){addLine("System","Server error",false);}
  }

  $('#sendVeya').addEventListener('click',()=>sendTo("Veya"));
  $('#sendOrion').addEventListener('click',()=>sendTo("Orion"));
  $('#sendBoth').addEventListener('click',sendBoth);
})();
</script>
</body>
</html>